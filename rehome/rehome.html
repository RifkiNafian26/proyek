<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PetResQ - Rehome Process</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link 
      href="https://fonts.googleapis.com/css2?family=Kavoon&family=Kreon:wght@300;400;500;600;700&display=swap" 
      rel="stylesheet">
    <link 
      rel="stylesheet" 
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- Feather Icon -->
    <script src="https://unpkg.com/feather-icons"></script>

    <!-- My Style -->
    <link rel="stylesheet" href="../css/style.css?v=2" />
    <link rel="stylesheet" href="stylerehome.css" />
  </head>
  <body>
    <!-- Navbar start -->
    <nav class="navbar">
      <a href="../index.html" class="navbar-logo">Pet<span>ResQ</span></a>

      <div class="navbar-nav">
        <a href="../index.html">Home</a>
        <a href="../adopt/adopt.php">Adopt</a>
        <a href="rehome.html">Rehome</a>
        <div class="navbar-dropdown">
          <a href="#care-guides" class="care-guides-link">Care Guides</a>
          <div class="dropdown-menu">
            <a href="../careguides/Dog Care Guides.html">Dog</a>
            <a href="../careguides/Cat Care Guides.html">Cat</a>
            <a href="../careguides/Rabbit Care Guides.html">Rabbit</a>
          </div>
        </div>
      </div>

      <div class="navbar-extra" aria-label="Top right taskbar">
        <a href="#" id="notification" aria-label="Notifications"
          ><i data-feather="bell"></i
        ></a>

        <button
          aria-label="User account"
          class="user-profile"
          id="user-profile"
          type="button"
        >
          <div class="user-profile-inner">
            <svg
              class="profile-icon"
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
            >
              <g data-name="Layer 2" id="Layer_2">
                <path
                  d="m15.626 11.769a6 6 0 1 0 -7.252 0 9.008 9.008 0 0 0 -5.374 8.231 3 3 0 0 0 3 3h12a3 3 0 0 0 3-3 9.008 9.008 0 0 0 -5.374-8.231zm-7.626-4.769a4 4 0 1 1 4 4 4 4 0 0 1 -4-4zm10 14h-12a1 1 0 0 1 -1-1 7 7 0 0 1 14 0 1 1 0 0 1 -1 1z"
                ></path>
              </g>
            </svg>
            <span class="user-name">LOGIN</span>
            <span class="user-initial" id="user-initial"></span>
          </div>
        </button>

        <!-- Profile Dropdown Menu -->
        <div class="profile-dropdown" id="profile-dropdown">
          <div class="dropdown-header">
            <div class="dropdown-user-name" id="dropdown-name"></div>
            <div class="dropdown-user-email" id="dropdown-email"></div>
          </div>
          <hr class="dropdown-divider" />
          <a href="#" id="logout-btn" class="dropdown-item">Logout</a>
        </div>
      </div>
    </nav>
    <!-- Navbar end -->

    <main class="rehome-container">
      <div class="content-wrapper">
        <nav class="stepper step-1">
          <ol>
            <li class="step current completed" data-step="1">
              <div class="icon-wrapper">
                <i class="fas fa-arrow-right"></i>
                <img
                  src="kelinci.png"
                  alt="Rabbit Icon"
                  class="stepper-pet-icon"
                />
              </div>
              <span class="step-label">Start</span>
            </li>

            <li class="step" data-step="2">
              <div class="icon-wrapper">
                <i class="fas fa-question"></i>
                <img
                  src="kelinci.png"
                  alt="Rabbit Icon"
                  class="stepper-pet-icon"
                />
              </div>
              <span class="step-label">Questions</span>
            </li>

            <li class="step" data-step="3">
              <div class="icon-wrapper">
                <i class="fas fa-image"></i>
                <img
                  src="kelinci.png"
                  alt="Rabbit Icon"
                  class="stepper-pet-icon"
                />
              </div>
              <span class="step-label">Pet's Images</span>
            </li>

            <li class="step" data-step="4">
              <div class="icon-wrapper">
                <i class="fas fa-paw"></i>
                <img
                  src="kelinci.png"
                  alt="Rabbit Icon"
                  class="stepper-pet-icon"
                />
              </div>
              <span class="step-label">Characteristics</span>
            </li>

            <li class="step" data-step="5">
              <div class="icon-wrapper">
                <i class="fas fa-map-marker-alt"></i>
                <img
                  src="kelinci.png"
                  alt="Rabbit Icon"
                  class="stepper-pet-icon"
                />
              </div>
              <span class="step-label">Pet's Location</span>
            </li>

            <li class="step" data-step="6">
              <div class="icon-wrapper">
                <i class="fas fa-book-open"></i>
                <img
                  src="kelinci.png"
                  alt="Rabbit Icon"
                  class="stepper-pet-icon"
                />
              </div>
              <span class="step-label">Pet's Story</span>
            </li>

            <li class="step" data-step="7">
              <div class="icon-wrapper">
                <i class="fas fa-file-alt"></i>
                <img
                  src="kelinci.png"
                  alt="Rabbit Icon"
                  class="stepper-pet-icon"
                />
              </div>
              <span class="step-label">Documents</span>
            </li>

            <li class="step" data-step="8">
              <div class="icon-wrapper">
                <i class="fas fa-check"></i>
                <img
                  src="kelinci.png"
                  alt="Rabbit Icon"
                  class="stepper-pet-icon"
                />
              </div>
              <span class="step-label">Confirm</span>
            </li>

            <li class="step" data-step="9">
              <div class="icon-wrapper">
                <i class="fas fa-hand-holding-heart"></i>
                <img
                  src="kelinci.png"
                  alt="Rabbit Icon"
                  class="stepper-pet-icon"
                />
              </div>
              <span class="step-label">Thank U</span>
            </li>
          </ol>
        </nav>

        <section
          id="step-1"
          class="form-step active"
          data-title="REHOME / START"
        >
          <div class="user-info-card">
            <div class="user-details">
              <p>Email/Username: <strong id="rehome-user-email">-</strong></p>
              <p>Name: <strong id="rehome-user-name">-</strong></p>
            </div>
          </div>

          <div class="form-actions center">
            <button class="btn btn-start" id="start-button">Start</button>
          </div>
        </section>

        <section id="step-2" class="form-step" data-title="REHOME / QUESTIONS">
          <form id="questions-form">
            <div class="form-group row-group">
              <label>Are you rehoming a dog, cat or rabbit?</label>
              <div class="radio-options">
                <label
                  ><input type="radio" name="pet_type" value="Dog" required />
                  Dog</label
                >
                <label
                  ><input type="radio" name="pet_type" value="Cat" /> Cat</label
                >
                <label
                  ><input type="radio" name="pet_type" value="Rabbit" />
                  Rabbit</label
                >
              </div>
            </div>

            <div class="form-group row-group">
              <label>Is your pet spayed or neutered?</label>
              <div class="radio-options">
                <label
                  ><input
                    type="radio"
                    name="spayed_neutered"
                    value="Yes"
                    required
                  />
                  Yes</label
                >
                <label
                  ><input type="radio" name="spayed_neutered" value="No" />
                  No</label
                >
              </div>
            </div>

            <div class="form-group">
              <label for="rehome_reason"
                >Why do you need to rehome your pet?</label
              >
              <select id="rehome_reason" name="rehome_reason" required>
                <option value="">Pick a value</option>
                <option value="Moving">Moving</option>
                <option value="Allergy">Allergy</option>
                <option value="Financial">Financial</option>
              </select>
            </div>

            <div class="form-group">
              <!-- Keep Duration field removed as requested -->
            </div>

            <div class="form-actions">
              <button class="btn btn-back" type="button" onclick="goToStep(1)">
                <i class="fas fa-arrow-left"></i> Back
              </button>
              <button class="btn btn-continue" type="submit">
                Continue <i class="fas fa-arrow-right"></i>
              </button>
            </div>
          </form>
        </section>

        <section
          id="step-3"
          class="form-step"
          data-title="REHOME / PET'S IMAGES"
        >
          <p class="image-note">
            The image format should (.jpg, .png, .jpeg).<br />The image
            measurements must be square in shape, with dimensions of 600 x 600
            pixels.<br />The maximum & minimum image size is 1024 and 240 KB.
          </p>

          <div class="image-upload-grid">
            <div class="image-upload-box">
              <i class="fas fa-camera"></i>
              <p>1024 KB</p>
              <input type="file" id="pet_image" accept="image/*" />
            </div>
          </div>

          <div class="form-actions">
            <button class="btn btn-back" type="button" onclick="goToStep(2)">
              <i class="fas fa-arrow-left"></i> Back
            </button>
            <button
              class="btn btn-continue"
              type="button"
              id="images-continue-button"
            >
              Continue <i class="fas fa-arrow-right"></i>
            </button>
          </div>
        </section>

        <section
          id="step-4"
          class="form-step"
          data-title="REHOME / CHARACTERISTICS"
        >
          <form id="characteristics-form">
            <div class="form-group">
              <label for="pet_name">Pet's Name *</label>
              <input type="text" id="pet_name" name="pet_name" required />
            </div>

            <div class="form-group">
              <label for="age_years">Age (Years) *</label>
              <input
                type="number"
                id="age_years"
                name="age_years"
                value="0"
                min="0"
                required
              />
            </div>

            <div class="form-group">
              <label for="breed">Breed(s) *</label>
              <input type="text" id="breed" name="breed" required />
            </div>

            <div class="form-group">
              <label for="color">Color *</label>
              <input type="text" id="color" name="color" required />
            </div>

            <div class="form-grid">
              <div class="form-group">
                <label for="weight">Weight (kg) *</label>
                <input
                  type="number"
                  id="weight"
                  name="weight"
                  step="0.1"
                  min="0"
                  required
                />
              </div>
              <div class="form-group">
                <label for="height">Height (cm) *</label>
                <input
                  type="number"
                  id="height"
                  name="height"
                  step="0.1"
                  min="0"
                  required
                />
              </div>
            </div>

            <div class="form-group">
              <label for="gender">Gender *</label>
              <select id="gender" name="gender" required>
                <option value="">Please Select</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
              </select>
            </div>

            <div class="form-actions">
              <button class="btn btn-back" type="button" onclick="goToStep(3)">
                <i class="fas fa-arrow-left"></i> Back
              </button>
              <button class="btn btn-continue" type="submit">
                Continue <i class="fas fa-arrow-right"></i>
              </button>
            </div>
          </form>
        </section>

        <section
          id="step-5"
          class="form-step"
          data-title="REHOME / PET'S LOCATION"
        >
          <form id="location-form">
            <div class="form-group">
              <label for="address_line1">Address line 1 *</label>
              <input
                type="text"
                id="address_line1"
                name="address_line1"
                required
              />
            </div>

            <div class="form-grid">
              <div class="form-group">
                <label for="city">City *</label>
                <input type="text" id="city" name="city" required />
              </div>
              <div class="form-group">
                <label for="location_postcode">Postcode *</label>
                <input
                  type="text"
                  id="location_postcode"
                  name="location_postcode"
                  inputmode="numeric"
                  pattern="[0-9]*"
                  required
                />
              </div>
            </div>

            <div class="form-actions">
              <button class="btn btn-back" type="button" onclick="goToStep(4)">
                <i class="fas fa-arrow-left"></i> Back
              </button>
              <button class="btn btn-continue" type="submit">
                Continue <i class="fas fa-arrow-right"></i>
              </button>
            </div>
          </form>
        </section>

        <section
          id="step-6"
          class="form-step"
          data-title="REHOME / PET'S STORY"
        >
          <form id="story-form">
            <div class="story-note">
              Share anything here about your pet. (Your pet profile will be
              visible to the public. For your safety, do not include any
              personal details or contact information). Include information such
              as:
              <ul>
                <li>
                  Your pet's history: how long you've had them, where you got
                  them from and why you need to rehome them
                </li>
                <li>
                  Details about who your pet has lived with, eg children and
                  other pets
                </li>
                <li>Your pet's favourite activities</li>
                <li>
                  A description of their personality, preferences and habits
                </li>
                <li>
                  Anything they're scared of such as fireworks, people in
                  uniform, other animals
                </li>
                <li>
                  The type of food they eat including the brand and amount.
                </li>
                <li>
                  Allergies, health conditions, and any medications your pet
                  takes
                </li>
                <li>
                  If you are listing a bonded pair, make sure you include
                  details about both pets
                </li>
              </ul>
            </div>
            <div class="form-group">
              <textarea
                id="pet_story"
                name="pet_story"
                class="story-textarea"
                placeholder="Type here..."
                required
              ></textarea>
            </div>

            <div class="form-actions">
              <button class="btn btn-back" type="button" onclick="goToStep(5)">
                <i class="fas fa-arrow-left"></i> Back
              </button>
              <button class="btn btn-continue" type="submit">
                Continue <i class="fas fa-arrow-right"></i>
              </button>
            </div>
          </form>
        </section>

        <section id="step-7" class="form-step" data-title="REHOME / DOCUMENTS">
          <p class="image-note">
            This will never be visible to the public and will be only shared to
            the adopter when you complete Rehome Process. For your safety, we
            recommend you to black out any personal information on any
            documents.
          </p>
          <p class="image-note" style="margin-top: -10px">
            If you have any vaccine history, proof of spay or neuter, and/or
            microchip info, please upload below. The image format should (.jpg,
            .png, .jpeg). The image measurements must be square in shape, with
            dimensions of 600 x 600 pixels. The maximum & minimum image size is
            1024 and 240 KB.
          </p>

          <div class="image-upload-grid">
            <div class="image-upload-box">
              <i class="fas fa-file-upload"></i>
              <p>Document 1</p>
              <input
                type="file"
                id="pet_documents"
                accept="image/*,.pdf"
                multiple
              />
            </div>
            <div class="image-upload-box">
              <i class="fas fa-file-upload"></i>
              <p>Document 2</p>
              <input type="file" accept="image/*,.pdf" multiple />
            </div>
            <div class="image-upload-box">
              <i class="fas fa-file-upload"></i>
              <p>Document 3</p>
              <input type="file" accept="image/*,.pdf" multiple />
            </div>
            <div class="image-upload-box">
              <i class="fas fa-file-upload"></i>
              <p>Document 4</p>
              <input type="file" accept="image/*,.pdf" multiple />
            </div>
          </div>

          <div class="form-actions">
            <button class="btn btn-back" type="button" onclick="goToStep(6)">
              <i class="fas fa-arrow-left"></i> Back
            </button>
            <button
              class="btn btn-continue"
              type="button"
              onclick="goToStep(8)"
            >
              Continue <i class="fas fa-arrow-right"></i>
            </button>
          </div>
        </section>

        <section id="step-8" class="form-step" data-title="REHOME / CONFIRM">
          <div class="confirm-summary">
            <h3 class="confirm-title">Review And Confirm Your Pet Details</h3>
            <div class="summary-list">
              <div class="summary-item">
                <strong>Pet's Name:</strong>
                <span id="summary-pet-name">-</span>
              </div>
              <div class="summary-item">
                <strong>Age (Years):</strong> <span id="summary-age">-</span>
              </div>
              <div class="summary-item">
                <strong>Breed(s):</strong> <span id="summary-breed">-</span>
              </div>
              <div class="summary-item">
                <strong>Color:</strong> <span id="summary-color">-</span>
              </div>
              <div class="summary-item">
                <strong>Weight (kg):</strong> <span id="summary-weight">-</span>
              </div>
              <div class="summary-item">
                <strong>Height (cm):</strong> <span id="summary-height">-</span>
              </div>
              <div class="summary-item">
                <strong>Gender:</strong> <span id="summary-gender">-</span>
              </div>
              <div class="summary-item">
                <strong>City:</strong> <span id="summary-city">-</span>
              </div>
              <div class="summary-item">
                <strong>Postcode:</strong> <span id="summary-postcode">-</span>
              </div>
              <div class="summary-item">
                <strong>Address:</strong> <span id="summary-address">-</span>
              </div>
              <div class="summary-item">
                <strong>Pet Type:</strong> <span id="summary-pet-type">-</span>
              </div>
              <div class="summary-item">
                <strong>Spayed/Neutered:</strong>
                <span id="summary-spayed">-</span>
              </div>
              <div class="summary-item">
                <strong>Reason to Rehome:</strong>
                <span id="summary-reason">-</span>
              </div>
              <div class="summary-item">
                <strong>Keep Duration:</strong> <span id="summary-keep">-</span>
              </div>
            </div>

            <div class="form-group confirm-agree" id="confirm-agree-wrapper">
              <input type="checkbox" id="confirm-agree" />
              <label for="confirm-agree"
                >I confirm that the above data is correct and I am ready to
                proceed with the rehome process.</label
              >
            </div>

            <div class="form-actions center">
              <button class="btn btn-back" type="button" onclick="goToStep(7)">
                <i class="fas fa-arrow-left"></i> Back
              </button>
              <button
                class="btn btn-continue"
                type="button"
                id="confirm-continue-button"
                disabled
              >
                Submit Your Pet
              </button>
            </div>
          </div>
        </section>

        <section id="step-9" class="form-step" data-title="REHOME / THANK U">
          <div class="thanks-message">
            <h3>Thanks for submitting!</h3>
            <p>
              We'll be in touch once we've reviewed your pet's profile. We want
              to make sure we give you the best chance of finding the right home
              for your pet.
            </p>
            <div style="text-align: center; margin: -20px 0 5px 0">
              <h2
                style="
                  font-size: 36px;
                  font-weight: bold;
                  color: #2c3e50;
                  margin-bottom: -25px;
                  letter-spacing: 2px;
                "
              >
                GOODBYE
              </h2>
              <img
                src="anjing.jpg"
                alt="Goodbye Pet"
                class="pet-image-done cat-decoration"
                style="width: 320px; height: auto"
              />
            </div>
            <div class="form-actions center">
              <button class="btn btn-profile" type="button">
                Go To My Profile
              </button>
            </div>
          </div>
        </section>
      </div>
    </main>

    <footer>
      <div class="footer-content">
        <div class="footer-left">
          <div class="footer-logo">PetResQ</div>
        </div>
        <div class="footer-right">
          <h3>Contact Us</h3>
          <div class="contact-item">
            <i class="fas fa-map-marker-alt"></i>
            <span
              >Jl. Pendidikan No.15, Cibiru Wetan, Kec. Cileunyi, Kabupaten
              Bandung.</span
            >
          </div>
          <div class="contact-item">
            <i class="fas fa-phone-alt"></i>
            <span>+62 898-6099-362</span>
          </div>
          <div class="contact-item">
            <i class="fas fa-envelope"></i>
            <span>kampus_cibiru@upi.edu</span>
          </div>
        </div>
      </div>
    </footer>

    <script src="../js/script.js"></script>
    <script>
      feather.replace();

      document.addEventListener("DOMContentLoaded", () => {
        // --- Elemen Global ---
        const startButton = document.getElementById("start-button");
        const questionsForm = document.getElementById("questions-form");
        const characteristicsForm = document.getElementById(
          "characteristics-form"
        );
        const locationForm = document.getElementById("location-form");
        const storyForm = document.getElementById("story-form");
        const imagesContinueBtn = document.getElementById(
          "images-continue-button"
        );
        const confirmContinueBtn = document.getElementById(
          "confirm-continue-button"
        );
        const confirmAgreeCheckbox = document.getElementById("confirm-agree");
        const confirmAgreeWrapper = document.getElementById(
          "confirm-agree-wrapper"
        );

        const stepperNav = document.querySelector(".stepper");
        const titleHeader = document.getElementById("rehome-title");

        // Simpan step sebelumnya untuk animasi lompat
        let previousStep = 1;

        // Populate Start step profile with user data
        function populateStartProfile() {
          const emailEl = document.getElementById("rehome-user-email");
          const nameEl = document.getElementById("rehome-user-name");

          if (!emailEl || !nameEl) return;

          fetch("../check_session.php")
            .then((response) => response.json())
            .then((data) => {
              if (data.is_logged_in) {
                emailEl.textContent = data.user_email || "-";
                nameEl.textContent = data.user_name || "-";
              } else {
                emailEl.textContent = "-";
                nameEl.textContent = "-";
              }
            })
            .catch((error) => {
              console.error("Error checking login:", error);
              emailEl.textContent = "-";
              nameEl.textContent = "-";
            });
        }

        // --- Fungsi Navigasi (Inti dari Multi-Step Form) ---
        window.goToStep = (stepNumber) => {
          const steps = document.querySelectorAll(".form-step");
          const stepperItems = document.querySelectorAll(".stepper .step");

          steps.forEach((step) => step.classList.remove("active"));
          const targetStep = document.getElementById(`step-${stepNumber}`);

          if (targetStep) {
            targetStep.classList.add("active");
            // titleHeader.textContent = targetStep.getAttribute('data-title');
          }

          stepperItems.forEach((item, index) => {
            const currentStep = index + 1;
            item.classList.remove("current");

            if (currentStep < stepNumber) {
              item.classList.add("completed");
            } else if (currentStep === stepNumber) {
              item.classList.add("current");
              item.classList.add("completed");
            } else {
              item.classList.remove("completed");
            }
          });

          stepperNav.className = "stepper";
          stepperNav.classList.add(`step-${stepNumber}`);

          previousStep = stepNumber;

          if (stepNumber === 8) {
            updateSummary();
            // Reset checkbox dan disable button saat masuk ke halaman confirm
            confirmAgreeCheckbox.checked = false;
            confirmContinueBtn.disabled = true;
          }
        };

        // --- Fungsi Upload Gambar (Baru!) ---
        const setupImageUpload = (containerId) => {
          const uploadBoxes = document.querySelectorAll(
            `#${containerId} .image-upload-box`
          );

          uploadBoxes.forEach((box) => {
            const input = box.querySelector('input[type="file"]');

            // Cek apakah tombol hapus sudah ada, jika belum buat
            let removeBtn = box.querySelector(".remove-image-btn");
            if (!removeBtn) {
              removeBtn = document.createElement("button");
              removeBtn.classList.add("remove-image-btn");
              removeBtn.innerHTML = '<i class="fas fa-times"></i>';
              removeBtn.style.display = "none";
              box.appendChild(removeBtn);
            }

            input.addEventListener("change", (event) => {
              const file = event.target.files[0];
              if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                  box.style.backgroundImage = `url('${e.target.result}')`;
                  box.classList.add("has-image");
                  removeBtn.style.display = "flex";
                };
                reader.readAsDataURL(file);
              }
            });

            removeBtn.addEventListener("click", (event) => {
              event.stopPropagation();
              event.preventDefault();
              box.style.backgroundImage = "none";
              box.classList.remove("has-image");
              input.value = "";
              removeBtn.style.display = "none";
            });
          });
        };

        // Pastikan 4 gambar diunggah sebelum lanjut
        const allImagesUploaded = () => {
          const inputs = document.querySelectorAll(
            '#step-3 .image-upload-box input[type="file"]'
          );
          if (inputs.length < 4) return false;
          return Array.from(inputs).every((input) => {
            const hasFile = input.files && input.files.length > 0;
            const hasImageClass = input
              .closest(".image-upload-box")
              ?.classList.contains("has-image");
            return hasFile || hasImageClass;
          });
        };

        // Panggil fungsi setupImageUpload untuk Tahap 3 dan Tahap 7 (documents)
        setupImageUpload("step-3");
        setupImageUpload("step-7");

        // Ambil nilai helper
        const getValue = (id) =>
          (document.getElementById(id)?.value || "").trim();
        const getRadioValue = (name) => {
          const el = document.querySelector(`input[name="${name}"]:checked`);
          return el ? el.value : "";
        };

        // Perbarui ringkasan konfirmasi
        const updateSummary = () => {
          const setText = (id, value) => {
            const el = document.getElementById(id);
            if (el) el.textContent = value || "-";
          };

          setText("summary-pet-name", getValue("pet_name"));
          setText("summary-age", getValue("age_years"));
          setText("summary-breed", getValue("breed"));
          setText("summary-color", getValue("color"));
          setText("summary-weight", getValue("weight"));
          setText("summary-height", getValue("height"));
          setText("summary-gender", getValue("gender"));
          setText("summary-city", getValue("city"));
          setText("summary-postcode", getValue("location_postcode"));
          setText("summary-address", getValue("address_line1"));
          setText("summary-pet-type", getRadioValue("pet_type"));
          setText("summary-spayed", getRadioValue("spayed_neutered"));
          setText("summary-reason", getValue("rehome_reason"));
          // removed keep duration
        };

        // --- Logika Tahap 1: START ---
        // Start button is enabled by default since the terms checkbox was removed
        startButton.addEventListener("click", (e) => {
          if (!startButton.disabled) {
            goToStep(2);
          }
        });

        // --- Logika Tahap 2: QUESTIONS ---
        questionsForm.addEventListener("submit", (e) => {
          e.preventDefault();
          if (questionsForm.checkValidity()) {
            goToStep(3);
          } else {
            alert("Mohon lengkapi semua isian yang wajib di Tahap Questions.");
          }
        });

        // --- Logika Tahap 3: PET'S IMAGES ---
        imagesContinueBtn.addEventListener("click", () => {
          const inputs = document.querySelectorAll(
            '#step-3 .image-upload-box input[type="file"]'
          );
          const boxes = document.querySelectorAll("#step-3 .image-upload-box");
          boxes.forEach((box) => box.classList.remove("error"));

          const missing = [];
          inputs.forEach((input) => {
            const box = input.closest(".image-upload-box");
            const hasFile = input.files && input.files.length > 0;
            const hasImageClass = box?.classList.contains("has-image");
            if (!(hasFile || hasImageClass)) {
              missing.push(box);
            }
          });

          if (missing.length === 0) {
            goToStep(4);
          } else {
            missing.forEach((box) => box?.classList.add("error"));
          }
        });

        // --- Logika Tahap 4: CHARACTERISTICS ---
        characteristicsForm.addEventListener("submit", (e) => {
          e.preventDefault();
          if (characteristicsForm.checkValidity()) {
            goToStep(5);
          } else {
            alert(
              "Mohon lengkapi semua isian yang wajib di Tahap Characteristics."
            );
          }
        });

        // --- Logika Tahap 5: PET'S LOCATION ---
        locationForm.addEventListener("submit", (e) => {
          e.preventDefault();
          if (locationForm.checkValidity()) {
            goToStep(6);
          } else {
            alert("Mohon lengkapi semua isian yang wajib di Tahap Location.");
          }
        });

        // --- Logika Tahap 6: PET'S STORY ---
        storyForm.addEventListener("submit", (e) => {
          e.preventDefault();
          if (storyForm.checkValidity()) {
            goToStep(7);
          } else {
            alert("Mohon lengkapi Pet's Story.");
          }
        });

        // --- Logika Tahap 8: CONFIRM ---
        // Enable/disable button berdasarkan checkbox
        confirmAgreeCheckbox.addEventListener("change", () => {
          confirmContinueBtn.disabled = !confirmAgreeCheckbox.checked;
        });

        confirmContinueBtn.addEventListener("click", () => {
          confirmAgreeWrapper.classList.remove("error");
          if (confirmAgreeCheckbox.checked) {
            // Kumpulkan data dari semua steps
            const formData = new FormData();

            // Step 2: Questions
            formData.append(
              "pet_type",
              document.querySelector('input[name="pet_type"]:checked')?.value ||
                ""
            );
            formData.append(
              "spayed_neutered",
              document.querySelector('input[name="spayed_neutered"]:checked')
                ?.value || ""
            );
            formData.append(
              "rehome_reason",
              document.getElementById("rehome_reason")?.value || ""
            );

            // Step 3: Pet Image
            const petImageInput = document.getElementById("pet_image");
            if (petImageInput?.files?.length > 0) {
              formData.append("pet_image", petImageInput.files[0]);
            }

            // Step 4: Characteristics
            formData.append(
              "pet_name",
              document.getElementById("pet_name")?.value || ""
            );
            formData.append(
              "age_years",
              document.getElementById("age_years")?.value || ""
            );
            formData.append(
              "breed",
              document.getElementById("breed")?.value || ""
            );
            formData.append(
              "color",
              document.getElementById("color")?.value || ""
            );
            formData.append(
              "weight",
              document.getElementById("weight")?.value || ""
            );
            formData.append(
              "height",
              document.getElementById("height")?.value || ""
            );
            formData.append(
              "gender",
              document.getElementById("gender")?.value || ""
            );

            // Step 5: Location
            formData.append(
              "address_line1",
              document.getElementById("address_line1")?.value || ""
            );
            formData.append(
              "city",
              document.getElementById("city")?.value || ""
            );
            formData.append(
              "postcode",
              document.getElementById("location_postcode")?.value || ""
            );

            // Step 6: Pet Story
            formData.append(
              "pet_story",
              document.getElementById("pet_story")?.value || ""
            );

            // Step 7: Documents
            const documentsInput = document.getElementById("pet_documents");
            if (documentsInput?.files?.length > 0) {
              for (let i = 0; i < documentsInput.files.length; i++) {
                formData.append("documents[]", documentsInput.files[i]);
              }
            }

            // Submit ke backend
            fetch("/PetResQ/rehome/submit_rehome.php", {
              method: "POST",
              body: formData,
              credentials: "include",
            })
              .then((response) => {
                // Log response status and content type
                console.log("Response status:", response.status);
                console.log(
                  "Response content-type:",
                  response.headers.get("content-type")
                );

                // Check if response is JSON
                if (
                  !response.headers
                    .get("content-type")
                    ?.includes("application/json")
                ) {
                  throw new Error(
                    "Server did not return JSON. Status: " + response.status
                  );
                }

                return response
                  .json()
                  .then((json) => {
                    if (!response.ok) {
                      const msg = json?.message || "Server error";
                      const detail = json?.detail
                        ? "\nDetail: " + json.detail
                        : "";
                      throw new Error(msg + detail);
                    }
                    return json;
                  })
                  .catch(async (err) => {
                    let raw = "";
                    try {
                      raw = await response.text();
                    } catch {}
                    const hint = raw ? "\nRaw: " + raw.substring(0, 500) : "";
                    throw new Error(
                      "Failed to parse JSON response: " + err.message + hint
                    );
                  });
              })
              .then((data) => {
                if (data.success) {
                  console.log("Submission successful:", data);
                  goToStep(9);
                } else {
                  alert("Error: " + (data.message || "Failed to submit"));
                }
              })
              .catch((error) => {
                console.error("Submission error:", error);
                alert("Error submitting form: " + error.message);
              });
          } else {
            confirmAgreeWrapper.classList.add("error");
            confirmAgreeCheckbox.focus();
          }
        });

        // Validasi postcode hanya angka
        const postcodeInput = document.getElementById("location_postcode");
        if (postcodeInput) {
          postcodeInput.addEventListener("input", (e) => {
            // Hanya izinkan angka
            e.target.value = e.target.value.replace(/[^0-9]/g, "");
          });

          postcodeInput.addEventListener("keypress", (e) => {
            // Cegah input non-numeric
            if (
              !/[0-9]/.test(e.key) &&
              ![
                "Backspace",
                "Delete",
                "Tab",
                "Enter",
                "ArrowLeft",
                "ArrowRight",
              ].includes(e.key)
            ) {
              e.preventDefault();
            }
          });
        }

        // Mulai dari tahap 1 saat halaman dimuat
        populateStartProfile();
        goToStep(1);
      });
    </script>

    <!-- Auth Modal (Login/Register) -->
    <div class="modal" id="auth-modal">
      <div class="modal-content modal-horizontal">
        <!-- Foto Hewan Login -->
        <div class="modal-image modal-image-login active">
          <img src="../icon/login2.jpg" alt="Login" />
        </div>

        <!-- Foto Hewan Register -->
        <div class="modal-image modal-image-register">
          <img src="../icon/register.jpg" alt="Register" />
        </div>

        <!-- Form Container -->
        <div class="modal-form-container">
          <div class="modal-header">
            <h2 id="modal-title">Login</h2>
            <button class="close-btn" id="close-modal">&times;</button>
          </div>

          <!-- Error Message Display -->
          <div class="form-error" id="form-error" style="display: none"></div>

          <!-- Login Form -->
          <form class="tab-content active" id="login-tab" method="POST">
            <div class="form-group">
              <label for="login-email">Email</label>
              <input
                type="email"
                id="login-email"
                name="email"
                placeholder="Enter your email"
                required
              />
            </div>

            <div class="form-group">
              <label for="login-password">Password</label>
              <input
                type="password"
                id="login-password"
                name="password"
                placeholder="Enter your password"
                required
              />
            </div>

            <div class="form-group checkbox">
              <input type="checkbox" id="remember-me" />
              <label for="remember-me">Remember me</label>
            </div>

            <button type="submit" class="btn-submit">Login</button>

            <p class="form-footer">
              Don't have an account?
              <a href="#" class="switch-tab" data-tab="register"
                >Register here</a
              >
            </p>
          </form>

          <!-- Register Form -->
          <form class="tab-content" id="register-tab" method="POST">
            <div class="form-group">
              <label for="register-name">Full Name</label>
              <input
                type="text"
                id="register-name"
                name="nama"
                placeholder="Enter your full name"
                required
              />
            </div>

            <div class="form-group">
              <label for="register-email">Email</label>
              <input
                type="email"
                id="register-email"
                name="email"
                placeholder="Enter your email"
                required
              />
            </div>

            <div class="form-group">
              <label for="register-password">Password</label>
              <input
                type="password"
                id="register-password"
                name="password"
                placeholder="Enter your password"
                required
              />
            </div>

            <div class="form-group">
              <label for="register-confirm">Confirm Password</label>
              <input
                type="password"
                id="register-confirm"
                name="confirm_password"
                placeholder="Confirm your password"
                required
              />
            </div>

            <div class="form-group checkbox">
              <input type="checkbox" id="agree-terms" required />
              <label for="agree-terms">I agree to the Terms & Conditions</label>
            </div>

            <button type="submit" class="btn-submit">Register</button>

            <p class="form-footer">
              Already have an account?
              <a href="#" class="switch-tab" data-tab="login">Login here</a>
            </p>
          </form>
        </div>
      </div>
    </div>
  </body>
</html>
